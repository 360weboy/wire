<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>dojo dom plugin insert facet test</title>

	<script src="../util/doh/runner.js"></script>
	<script src="../test-config.js"></script>

    <script type="text/javascript">

		define('NodeFactory', function () {
			return function NodeFactory (node) {
				return node;
			}
		});

		require(['wire'], function (wire) {
			var wired, undef;

			wired = wire({
				plugins: [
					{ module: 'wire/debug' },
					{ module: 'wire/dojo/dom' }
				],
				parentNode: {
					$ref: 'dom!target'
				},
				parentNode2: {
					$ref: 'dom!target2'
				},
				firstNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!first' }
					},
					insert: {
						at: 'parentNode',
						where: 'first'
					}
				},
				lastNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!last' }
					},
					insert: {
						at: 'parentNode',
						where: 'last'
					}
				},
				middleNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!middle' }
					},
					insert: {
						at: 'parentNode',
						where: 2
					}
				},
				afterNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!after' }
					},
					insert: {
						at: 'parentNode',
						where: 'after'
					}
				},
				beforeNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!before' }
					},
					insert: {
						at: 'parentNode',
						where: 'before'
					}
				},
				zeroNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!zero' }
					},
					insert: {
						at: 'parentNode2',
						where: 0
					}
				},
				oneNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!one' }
					},
					insert: {
						at: 'parentNode2',
						where: 1
					}
				},
				twoNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!two' }
					},
					insert: {
						at: 'parentNode2',
						where: 2
					}
				},
				nineTnineNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!nineTnine' }
					},
					insert: {
						at: 'parentNode2',
						where: 99
					}
				},
				negativeNode: {
					create: {
						module: 'NodeFactory',
						args: { $ref: 'dom!negative' }
					},
					insert: {
						at: 'parentNode2',
						where: -1
					}
				}
			});

            doh.register('word locations', [
                function insertFirst(doh) {
                    var dohd = new doh.Deferred();
                    wired.then(
                        function(context) {
							dohd.callback(context.firstNode == context.parentNode.firstChild);
                        },
                        function(e) {
                            dohd.errback(e);
                        }
                    );
                    return dohd;
				},
                function insertLast(doh) {
                    var dohd = new doh.Deferred();
                    wired.then(
                        function(context) {
							dohd.callback(context.lastNode == context.parentNode.lastChild);
                        },
                        function(e) {
                            dohd.errback(e);
                        }
                    );
                    return dohd;
				},
                function insertMiddle(doh) {
                    var dohd = new doh.Deferred();
                    wired.then(
                        function(context) {
							var children = context.parentNode.childNodes;
							dohd.callback(context.middleNode == children[(children.length - 1) / 2]);
                        },
                        function(e) {
                            dohd.errback(e);
                        }
                    );
                    return dohd;
				},
                function insertBefore(doh) {
                    var dohd = new doh.Deferred();
                    wired.then(
                        function(context) {
							dohd.callback(context.beforeNode == context.parentNode.previousSibling);
                        },
                        function(e) {
                            dohd.errback(e);
                        }
                    );
                    return dohd;
				},
                function insertAfter(doh) {
                    var dohd = new doh.Deferred();
                    wired.then(
                        function(context) {
							dohd.callback(context.afterNode == context.parentNode.nextSibling);
                        },
                        function(e) {
                            dohd.errback(e);
                        }
                    );
                    return dohd;
				}
			]);

			doh.register('number locations', [
				function insert0(doh) {
				   var dohd = new doh.Deferred();
				   wired.then(
					   function(context) {
							dohd.callback(context.zeroNode == context.parentNode2.childNodes[1]);
					   },
					   function(e) {
						   dohd.errback(e);
					   }
				   );
				   return dohd;
				},
				function insert1(doh) {
				   var dohd = new doh.Deferred();
				   wired.then(
					   function(context) {
							dohd.callback(context.oneNode == context.parentNode2.childNodes[2]);
					   },
					   function(e) {
						   dohd.errback(e);
					   }
				   );
				   return dohd;
				},
				function insert2(doh) {
				   var dohd = new doh.Deferred();
				   wired.then(
					   function(context) {
							dohd.callback(context.twoNode == context.parentNode2.childNodes[3]);
					   },
					   function(e) {
						   dohd.errback(e);
					   }
				   );
				   return dohd;
				},
				function insert99(doh) {
				   var dohd = new doh.Deferred();
				   wired.then(
					   function(context) {
							dohd.callback(context.nineTnineNode == context.parentNode2.lastChild);
					   },
					   function(e) {
						   dohd.errback(e);
					   }
				   );
				   return dohd;
				},
				function insertNeg(doh) {
				   var dohd = new doh.Deferred();
				   wired.then(
					   function(context) {
							dohd.callback(context.negativeNode == context.parentNode2.firstChild);
					   },
					   function(e) {
						   dohd.errback(e);
					   }
				   );
				   return dohd;
				}
			]);

            doh.run();
        });

    </script>
</head>
<body>
<div>
	<div id="target"><p></p><p></p></div>
    <p id="last">last</p>
	<p id="first">first</p>
	<p id="after">after</p>
    <p id="before">before</p>
	<p id="middle">middle</p>
<hr/>
	<div id="target2"></div>
	<p id="one">1</p>
	<p id="two">2</p>
	<p id="zero">0</p>
	<p id="nineTnine">99</p>
	<p id="negative">-1</p>
</div>
</body>
</html>